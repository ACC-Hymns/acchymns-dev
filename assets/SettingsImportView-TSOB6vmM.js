import{d as L,r as D,av as U,V as F,p as W,c as C,aw as o,Q as q,a as l,b as n,f as j,k as d,w as z,$ as Q,ax as O,F as v,C as x,a6 as P,ay as S,O as g,az as G,o as a,e as h,i as b,aA as J,at as E,g as m,ak as K,_ as X,aB as Y,aC as Z,aD as tt,aq as et,as as st,ap as nt,l as at}from"./index-D2bSb7K5.js";import{_ as it}from"./chevron-back-outline-WBEKPQRX.js";import{_ as ot}from"./close-CPTb3vCw.js";import{T as i}from"./index-Baif7MmL.js";const lt="/acchymns-dev/assets/enter-outline.svg",rt="/acchymns-dev/assets/arrow-down-circle-outline.svg",ut="/acchymns-dev/assets/trash-outline.svg",ct={class:"menu"},dt={class:"title"},mt={class:"main-content"},ft={class:"input-option reference-option"},wt={key:0},pt={key:1,class:"warning-label-container"},yt=["onClick"],vt={key:2},gt={key:3,class:"warning-label-container"},ht={class:"button-array"},_t=["onClick"],kt=["onClick"],Dt={key:4},Ct={class:"button-array"},xt=["onClick"],bt=L({__name:"SettingsImportView",setup(Et){let r=D(new Map),f=D(new Map);U(async()=>{f.value.forEach(async(e,t)=>{await e.cancel(),r.value.delete(t)})});const w=F("bookSources",[]);let I=W("import_books_tooltip_complete",!1);const p=C(()=>w.value.filter(t=>t.status==o.PREVIEW)),_=C(()=>w.value.filter(e=>e.status==o.IMPORTED)),$=C(()=>w.value.filter(e=>e.status==o.DOWNLOADED)),k=D("");async function T(e,t=!0){let s=w.value.find(c=>c.id==e.id);if(s==null)return!1;if((await S.getStatus()).connected)g.getPlatform()!=="web"&&await G(s);else return await i.show({text:"No internet connection."}),!1;let y=null;try{const c=new AbortController,M=setTimeout(()=>c.abort(),2e3);y=await fetch(s.src+"/summary.json",{method:"HEAD",signal:c.signal}),clearTimeout(M)}catch(c){if(c.name=="TypeError")return await i.show({text:"Failed to load hymnal!"}),!1;if(c.name!="AbortError")throw c}return y==null||!y.ok||y.status!=200?(await i.show({text:"Failed to load hymnal!"}),!1):s.status!=o.IMPORTED?(s.status=o.IMPORTED,t&&await i.show({text:"Successfully imported hymnal!"}),!0):(await i.show({text:"Hymnal already imported!"}),!1)}async function B(e){if(e=e.toUpperCase(),e in P){const t=w.value.find(s=>s.id==e);if(t==null)return;t.status==o.IMPORTED||t.status==o.DOWNLOADED?await i.show({text:`Hymnal (${e}) already imported!`}):await T(t,!1)&&await i.show({text:`Successfully imported hymnal (${e})!`})}else await i.show({text:`Unknown hymnal reference (${e})!`})}async function N(e){if((await S.getStatus()).connected){let t=Y(e,(s,u)=>H(s,u),(s,u)=>R(s,u));f.value.set(e.id,t)}else await i.show({text:"No internet connection."});console.log("Downloads:",f.value)}async function H(e,t){r.value.set(e.id,t)}async function R(e,t){e.src=t,e.status=o.DOWNLOADED,await i.show({text:"Successfully downloaded hymnal!"})}q(()=>{I.value||(I.value=!0)});async function V(e){var t;e.status=Object.keys(Z).includes(e.id)?o.PREVIEW:o.HIDDEN,f.value.has(e.id)&&((t=f.value.get(e.id))==null||t.cancel(),r.value.delete(e.id)),g.getPlatform()!=="web"&&await tt(e),await i.show({text:"Successfully removed hymnal!"})}async function A(e){e.status=o.IMPORTED,e.src=P[e.id],await et.rmdir({directory:st.Data,path:`Hymnals/${e.id}`,recursive:!0}),r.value.delete(e.id),nt(),await i.show({text:"Successfully deleted hymnal!"})}return(e,t)=>(a(),l(v,null,[n("div",ct,[n("div",dt,[n("img",{onClick:t[0]||(t[0]=s=>e.$router.back()),class:"ionicon title--left",src:it}),t[3]||(t[3]=n("div",{class:"title--center"},[n("h1",null,"Import Hymnals")],-1))])]),n("div",mt,[n("div",ft,[z(n("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),type:"text",class:"search-bar",placeholder:"Book Code"},null,512),[[Q,k.value,void 0,{trim:!0}]]),n("button",{onClick:t[2]||(t[2]=s=>B(k.value)),class:"reference-button"},t[4]||(t[4]=[n("img",{class:"ionicon enter-button-icon",src:lt},null,-1)]))]),p.value.length!=0?(a(),l("h2",wt,"Available Hymnals")):d("",!0),p.value.length!=0?(a(),l("div",pt,t[5]||(t[5]=[n("img",{class:"ionicon warning-icon",src:O},null,-1),n("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)]))):d("",!0),n("div",null,[(a(!0),l(v,null,x(p.value,s=>(a(),h(E,{key:s.id,src:s.src,"with-link":!1},{default:b(()=>[n("button",{onClick:u=>T(s)},t[6]||(t[6]=[n("img",{class:"ionicon ionicon-custom booktext--right add-button-icon",src:J},null,-1)]),8,yt)]),_:2},1032,["src"]))),128))]),_.value.length!=0?(a(),l("h2",vt,"Imported Hymnals")):d("",!0),_.value.length!=0&&p.value.length==0?(a(),l("div",gt,t[7]||(t[7]=[n("img",{class:"ionicon warning-icon",src:O},null,-1),n("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)]))):d("",!0),n("div",null,[(a(!0),l(v,null,x(_.value,s=>(a(),h(E,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:b(()=>[n("div",ht,[(m(r).get(s.id)||0)<1&&m(g).getPlatform()!=="web"?(a(),l("button",{key:0,onClick:u=>N(s)},t[8]||(t[8]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:rt},null,-1)]),8,_t)):d("",!0),(m(r).get(s.id||"")||0)>=1&&(m(r).get(s.id||"")||0)<100&&m(g).getPlatform()!=="web"?(a(),h(K,{key:1,radius:15,progress:m(r).get(s.id||"")||0,stroke:3,transform:"rotate(-90) translate(-25 -8)"},null,8,["progress"])):d("",!0),n("button",{onClick:u=>V(s)},t[9]||(t[9]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:ot},null,-1)]),8,kt)])]),_:2},1032,["src"]))),128))]),$.value.length!=0?(a(),l("h2",Dt,"Downloaded Hymnals")):d("",!0),n("div",null,[(a(!0),l(v,null,x($.value,s=>(a(),h(E,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:b(()=>[n("div",Ct,[n("button",{onClick:u=>A(s)},t[10]||(t[10]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:ut},null,-1)]),8,xt)])]),_:2},1032,["src"]))),128))]),t[11]||(t[11]=n("div",{style:{"padding-bottom":"200px"}},null,-1))]),j(X,{current_page:"settings"})],64))}}),Pt=at(bt,[["__scopeId","data-v-95712819"]]);export{Pt as default};
